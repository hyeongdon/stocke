<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>시그널 라이프사이클 추적</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="/static/style-hts.css">
    <style>
        /* HTS 스타일 오버라이드 */
        body {
            background-color: #f0f0f0;
            font-family: -apple-system, 'Malgun Gothic', '맑은 고딕', 'Segoe UI', sans-serif;
            font-size: 12px;
        }

        .lifecycle-container {
            max-width: 100%;
            margin: 2px;
            padding: 2px;
        }

        .signal-card {
            background: #ffffff;
            border: 1px solid #a0a0a0;
            border-radius: 0;
            padding: 8px;
            margin-bottom: 4px;
            box-shadow: none;
            transition: none;
        }

        .signal-card:hover {
            background: #fffef8;
        }

        .signal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            padding-bottom: 6px;
            border-bottom: 1px solid #d0d0d0;
        }

        .stock-info {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stock-name {
            font-size: 13px;
            font-weight: bold;
            color: #000;
        }

        .stock-code {
            font-size: 12px;
            color: #333;
            background: #f8f8f8;
            padding: 2px 6px;
            border: 1px solid #d0d0d0;
            border-radius: 0;
        }

        .signal-time {
            color: #666;
            font-size: 11px;
        }

        /* 라이프사이클 타임라인 - HTS 스타일 */
        .lifecycle-timeline {
            position: relative;
            padding: 15px 0;
            background: #fafafa;
            border: 1px solid #d0d0d0;
            margin: 4px 0;
        }

        .timeline-steps {
            display: flex;
            justify-content: space-between;
            position: relative;
            z-index: 2;
        }

        .timeline-line {
            position: absolute;
            top: 23px;
            left: 5%;
            right: 5%;
            height: 2px;
            background: #c0c0c0;
            z-index: 1;
        }

        .timeline-progress {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: #008000;
            transition: width 0.3s ease;
        }

        .timeline-step {
            flex: 1;
            text-align: center;
            position: relative;
        }

        .step-icon {
            width: 40px;
            height: 40px;
            border-radius: 0;
            background: #ffffff;
            border: 2px solid #a0a0a0;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 6px;
            font-size: 16px;
            color: #666;
            transition: none;
        }

        .step-icon.completed {
            background: #008000;
            border-color: #008000;
            color: white;
        }

        .step-icon.active {
            background: #0066cc;
            border-color: #0066cc;
            color: white;
            animation: blink 1s infinite;
        }

        .step-icon.failed {
            background: #ff0000;
            border-color: #ff0000;
            color: white;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .step-label {
            font-size: 11px;
            font-weight: bold;
            color: #000;
            margin-bottom: 2px;
        }

        .step-time {
            font-size: 10px;
            color: #666;
        }

        .step-status {
            font-size: 10px;
            margin-top: 2px;
            padding: 1px 4px;
            border-radius: 0;
            display: inline-block;
            border: 1px solid;
        }

        .step-status.success {
            background: #e0f0e0;
            color: #008000;
            border-color: #008000;
        }

        .step-status.error {
            background: #ffe0e0;
            color: #ff0000;
            border-color: #ff0000;
        }

        .step-status.processing {
            background: #e0e8ff;
            color: #0066cc;
            border-color: #0066cc;
        }

        /* 상세 정보 - HTS 스타일 */
        .detail-section {
            margin-top: 8px;
            padding-top: 6px;
            border-top: 1px solid #d0d0d0;
        }

        .detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 4px;
        }

        .detail-item {
            background: #ffffff;
            padding: 4px 6px;
            border: 1px solid #d0d0d0;
            border-radius: 0;
        }

        .detail-item.detail-highlight {
            background: #fffef0;
            border: 2px solid #0066cc;
        }

        .detail-label {
            font-size: 10px;
            color: #666;
            margin-bottom: 2px;
        }

        .detail-value {
            font-size: 12px;
            font-weight: bold;
            color: #000;
        }

        .text-success {
            color: #ff0000 !important;
            font-weight: bold;
        }

        .text-danger {
            color: #0066cc !important;
            font-weight: bold;
        }

        /* 오류 메시지 - HTS 스타일 */
        .error-message {
            background: #fff0f0;
            border: 1px solid #ff0000;
            border-radius: 0;
            padding: 6px 8px;
            margin-top: 4px;
            font-size: 11px;
        }

        .error-message i {
            color: #ff0000;
            margin-right: 4px;
        }

        /* 필터 및 컨트롤 - HTS 스타일 */
        .controls {
            background: #e8e8e8;
            padding: 6px 8px;
            border-radius: 0;
            margin-bottom: 4px;
            border: 1px solid #a0a0a0;
        }

        .filter-buttons {
            display: flex;
            gap: 4px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 3px 10px;
            border: 1px solid #a0a0a0;
            background: #ffffff;
            border-radius: 0;
            cursor: pointer;
            transition: none;
            font-size: 11px;
            font-weight: bold;
        }

        .filter-btn:hover {
            background: #f0f0f0;
        }

        .filter-btn.active {
            background: #0066cc;
            border-color: #0066cc;
            color: white;
        }

        .badge-status {
            padding: 2px 6px;
            border-radius: 0;
            font-size: 11px;
            font-weight: bold;
            border: 1px solid;
        }

        .badge-pending { background: #ffffcc; color: #806000; border-color: #cc9900; }
        .badge-processing { background: #ccddff; color: #003380; border-color: #0066cc; }
        .badge-ordered { background: #ccffcc; color: #006600; border-color: #008000; }
        .badge-failed { background: #ffcccc; color: #800000; border-color: #ff0000; }

        /* 새로고침 애니메이션 */
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .rotating {
            animation: rotate 1s linear infinite;
        }
    </style>
</head>
<body>
    <!-- HTS 스타일 헤더 -->
    <header class="bg-primary text-white" style="padding: 4px 8px; background: linear-gradient(to bottom, #4a4a4a 0%, #2a2a2a 100%) !important; border-bottom: 1px solid #000;">
        <div class="d-flex justify-content-between align-items-center">
            <h1 style="font-size: 12px; margin: 0; font-weight: bold;">
                <i class="fas fa-chart-line" style="font-size: 11px;"></i> 시그널 라이프사이클 추적
            </h1>
            <div>
                <button class="btn btn-sm" id="refreshBtn" style="padding: 2px 8px; font-size: 11px; background: #555; border: 1px solid #777; color: white;">
                    <i class="fas fa-sync-alt"></i> 새로고침
                </button>
                <button class="btn btn-sm" onclick="window.location.href='/'" style="padding: 2px 8px; font-size: 11px; background: #333; border: 1px solid #555; color: white;">
                    <i class="fas fa-home"></i> 메인
                </button>
            </div>
        </div>
    </header>
    
    <div class="lifecycle-container">

        <div class="controls">
            <div class="d-flex justify-content-between align-items-center" style="margin-bottom: 4px;">
                <div>
                    <label style="font-size: 11px; font-weight: bold; margin-right: 6px;">필터:</label>
                    <div class="filter-buttons d-inline-flex">
                        <button class="filter-btn active" data-filter="all">전체</button>
                        <button class="filter-btn" data-filter="pending">대기중</button>
                        <button class="filter-btn" data-filter="processing">처리중</button>
                        <button class="filter-btn" data-filter="ordered">완료</button>
                        <button class="filter-btn" data-filter="failed">실패</button>
                    </div>
                    <button id="cleanupFailedBtn" class="btn btn-sm btn-danger ms-2" style="display: none; font-size: 11px; padding: 3px 8px;">
                        <i class="fas fa-trash-alt"></i> 실패건 정리
                    </button>
                </div>
                <div style="font-size: 11px;">
                    <span style="margin-right: 4px;">자동새로고침</span>
                    <input type="checkbox" id="autoRefresh" checked style="vertical-align: middle;">
                </div>
            </div>
            <div style="font-size: 10px; color: #666;">
                <i class="fas fa-info-circle" style="font-size: 9px;"></i>
                업데이트: <span id="lastUpdate">-</span> | 
                총 <span id="totalCount">0</span>개 | 
                자동새로고침: 60초 간격 (현재가는 손절 모니터링에서 2분마다 자동 갱신)
            </div>
        </div>

        <div id="signalList">
            <!-- 시그널 카드들이 여기에 동적으로 추가됩니다 -->
        </div>

        <div id="emptyState" class="text-center" style="display: none; padding: 40px; background: white; border: 1px solid #a0a0a0;">
            <i class="fas fa-inbox" style="font-size: 48px; color: #999; margin-bottom: 12px;"></i>
            <div style="font-size: 13px; font-weight: bold; margin-bottom: 6px;">시그널이 없습니다</div>
            <div style="font-size: 11px; color: #666;">조건식을 활성화하거나 python create_sample_signals.py 로 테스트 데이터를 생성하세요</div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/modules/signal-lifecycle.js?v=20260116-7-cleanup"></script>
</body>
</html>

